<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body onload="init()">
    <script src="./CodeMirror/lib/codemirror.js"></script>
    <link rel="stylesheet" type="text/css" href="./CodeMirror/lib/codemirror.css">
    <link rel="stylesheet" type="text/css" href="./CodeMirror/theme/darcula.css">
    <script src="./CodeMirror/mode/javascript/javascript.js"></script>
    <script type="text/javascript">
        let myFileManager;
        let myFileBrowser;
        let myGrid;

        let version = '18w39a';

        function init() {
            //Include all needed modules
            const grid = require('./grid');
            const fileManager = require('./fileManager');
            const fileBrowser = require('./fileBrowser');

            //Initialize the file manager, and load the configuration file.
            myFileManager = new fileManager();
            myFileBrowser = new fileBrowser();
            myFileManager.initialize().then(function(result) {

                console.log("Perlenspeil IDE Version:", version);
                console.log("Created by Bailey Sostek with the help of Professor Brian Moriarty in 2018");

                myGrid = new grid(screen.width, screen.height);

                let editorDiv = document.createElement('div');
                editorDiv.setAttribute('id', 'editor');
                var editor = CodeMirror(editorDiv, {
                    mode: "javascript",
                    theme: "darcula",
                    lineNumbers: true,
                });


                //Set the Editor data to be the game.js of the current project.
                myFileManager.loadFile('game.js').then(function(result) {
                    editor.setValue(result);
                }, function(err) {
                    console.log(err);
                });

                editor.setSize('auto', 700);

                let column1 = myGrid.addColumn(myGrid.createColumn("Test" , '#414141'));
                myFileManager.getProjectFiles().then(function(result) {
                    let line = "";
                    for(var i = 0; i < result.length; i++){
                        line += result[i] +'\n';
                    }
                    column1.element.innerText = line;
                }, function(err) {
                    console.log(err);
                });

                myGrid.addColumn(myGrid.createColumn(editorDiv, '#232323'));
                let column3 = myGrid.addColumn(myGrid.createColumn("test", '#414141'));
                // myGrid.addColumn(myGrid.createColumn("Test" , '#004106'));
                // myGrid.addColumn(myGrid.createColumn("test", '#002341'));


                let psTest = document.createElement("webview");
                // psTest.setAttribute("src", "http://users.wpi.edu/~bhsostek/Assignment13/game.html");
                psTest.setAttribute("src", "Projects/cube/game.html");
                psTest.style.height = 100+'%';

                column3.setChildren(psTest);

                myFileManager.getProjectData('WIDTHS').then(function(result) {
                    console.log("WIDTHS", result);
                    myGrid.initializeWidths(result);
                }, function(err) {
                    console.log(err);
                });

                myGrid.refresh();
                editor.refresh();

            }, function(err) {
                console.log(err);
            });
        }

        function onCloseRequested(){
            myFileManager.writeToProperties('WIDTHS', myGrid.getColumnWidths());
        }

    </script>
</body>
</html>