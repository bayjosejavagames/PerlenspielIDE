<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body onload="init()">
    <script src="./node_modules/codemirror/lib/codemirror.js"></script>
    <link rel="stylesheet" type="text/css" href="./node_modules/codemirror/lib/codemirror.css">
    <link rel="stylesheet" type="text/css" href="./node_modules/codemirror/theme/darcula.css">
    <script src="./node_modules/codemirror/mode/javascript/javascript.js"></script>
    <script type="text/javascript">
        let myFileManager;
        let myGrid;

        function init() {
            //Include all needed modules
            const CodeMirror = require('codemirror');
            const grid = require('./grid');
            const fileManager = require('./fileManager');

            //Initialize the file manager, and load the configuration file.
            myFileManager = new fileManager();
            myFileManager.initialize().then(function(result) {

                console.log("Initialized?", myFileManager.INITIALIZED);

                myGrid = new grid(screen.width, screen.height);

                let editorDiv = document.createElement('div');
                editorDiv.setAttribute('id', 'editor');
                var editor = CodeMirror(editorDiv, {
                    mode: "javascript",
                    theme: "darcula",
                    lineNumbers: true,
                });


                //Set the Editor data to be the game.js of the current project.
                myFileManager.loadFile('game.js').then(function(result) {
                    editor.setValue(result);
                }, function(err) {
                    console.log(err);
                });

                editor.setSize('auto', 700);

                // let psTest = document.createElement("webview");
                // psTest.setAttribute("src", "http://users.wpi.edu/~bhsostek/Assignment13/game.html");
                // psTest.style.height = 100+'%';

                // editorDiv.appendChild(psTest);

                myGrid.addColumn(myGrid.createColumn("Test" , '#414141'));
                myGrid.addColumn(myGrid.createColumn(editorDiv, '#232323'));
                myGrid.addColumn(myGrid.createColumn("test", '#414141'));
                myGrid.addColumn(myGrid.createColumn("Test" , '#004106'));
                myGrid.addColumn(myGrid.createColumn("test", '#002341'));

                myFileManager.getProjectData('WIDTHS').then(function(result) {
                    console.log("WIDTHS", result);
                    myGrid.initializeWidths(result);
                }, function(err) {
                    console.log(err);
                });

                myGrid.refresh();
                editor.refresh();

            }, function(err) {
                console.log(err);
            });
        }

        function onCloseRequested(){
            myFileManager.writeToProperties('WIDTHS', myGrid.getColumnWidths());
        }

    </script>
</body>
</html>